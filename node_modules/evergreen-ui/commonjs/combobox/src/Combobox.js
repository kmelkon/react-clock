"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _uiBox = _interopRequireWildcard(require("ui-box"));

var _autocomplete = require("../../autocomplete");

var _textInput = require("../../text-input");

var _buttons = require("../../buttons");

var Combobox =
/*#__PURE__*/
function (_PureComponent) {
  (0, _inherits2.default)(Combobox, _PureComponent);

  function Combobox(props, context) {
    var _this;

    (0, _classCallCheck2.default)(this, Combobox);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(Combobox).call(this, props, context));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "handleStateChange", function (changes) {
      if (Object.prototype.hasOwnProperty.call(changes, 'isOpen')) {
        if (!changes.isOpen) {
          _this.setState({
            isOpenedByButton: false
          });
        }
      }
    });
    _this.state = {
      isOpenedByButton: false
    };
    return _this;
  }

  (0, _createClass2.default)(Combobox, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          items = _this$props.items,
          selectedItem = _this$props.selectedItem,
          defaultSelectedItem = _this$props.defaultSelectedItem,
          itemToString = _this$props.itemToString,
          width = _this$props.width,
          height = _this$props.height,
          onChange = _this$props.onChange,
          placeholder = _this$props.placeholder,
          inputProps = _this$props.inputProps,
          buttonProps = _this$props.buttonProps,
          openOnFocus = _this$props.openOnFocus,
          autocompleteProps = _this$props.autocompleteProps,
          props = (0, _objectWithoutProperties2.default)(_this$props, ["items", "selectedItem", "defaultSelectedItem", "itemToString", "width", "height", "onChange", "placeholder", "inputProps", "buttonProps", "openOnFocus", "autocompleteProps"]);
      return _react.default.createElement(_autocomplete.Autocomplete, (0, _extends2.default)({
        items: items,
        selectedItem: selectedItem,
        defaultSelectedItem: defaultSelectedItem,
        itemToString: itemToString,
        onChange: onChange,
        onStateChange: this.handleStateChange,
        isFilterDisabled: this.state.isOpenedByButton
      }, autocompleteProps), function (_ref) {
        var getRef = _ref.getRef,
            isShown = _ref.isShown,
            openMenu = _ref.openMenu,
            inputValue = _ref.inputValue,
            getInputProps = _ref.getInputProps,
            getButtonProps = _ref.getButtonProps,
            clearSelection = _ref.clearSelection;
        return _react.default.createElement(_uiBox.default, (0, _extends2.default)({
          innerRef: function innerRef(ref) {
            return getRef(ref);
          },
          display: "inline-flex",
          width: width
        }, props), _react.default.createElement(_textInput.TextInput, (0, _extends2.default)({
          width: 0,
          flex: 1,
          height: height,
          value: inputValue,
          borderTopRightRadius: 0,
          borderBottomRightRadius: 0
        }, getInputProps((0, _objectSpread2.default)({}, inputProps, {
          placeholder: placeholder,
          onFocus: function onFocus() {
            if (openOnFocus) openMenu();
          },
          onChange: function onChange(e) {
            if (_this2.state.isOpenedByButton) {
              _this2.setState({
                isOpenedByButton: false
              });
            }

            if (e.target.value.trim() === '') {
              // Prevent the selected item from sticking around
              clearSelection();
            }
          }
        })))), _react.default.createElement(_buttons.IconButton, (0, _extends2.default)({
          iconAim: "down",
          color: "muted",
          icon: "caret-down",
          appearance: "default",
          height: height,
          marginLeft: -1,
          paddingLeft: 0,
          paddingRight: 0,
          borderTopLeftRadius: 0,
          borderBottomLeftRadius: 0
        }, getButtonProps((0, _objectSpread2.default)({}, buttonProps, {
          onClick: function onClick() {
            if (!isShown) {
              _this2.setState({
                isOpenedByButton: true
              });
            }
          }
        })))));
      });
    }
  }]);
  return Combobox;
}(_react.PureComponent);

exports.default = Combobox;
Combobox.displayName = "Combobox";
(0, _defineProperty2.default)(Combobox, "propTypes", (0, _objectSpread2.default)({}, _uiBox.dimensions.propTypes, _uiBox.spacing.propTypes, _uiBox.position.propTypes, _uiBox.layout.propTypes, {
  /**
   * The options to show in the menu.
   */
  items: _propTypes.default.array.isRequired,

  /**
   * The selected item when controlled.
   */
  selectedItem: _propTypes.default.any,

  /**
   * Function called when value changes.
   */
  onChange: _propTypes.default.func,

  /**
   * When true, open the autocomplete on focus.
   */
  openOnFocus: _propTypes.default.bool,

  /**
   * Default selected item when uncontrolled.
   */
  defaultSelectedItem: _propTypes.default.any,

  /**
   * The placeholder text when there is no value present.
   */
  placeholder: _propTypes.default.string,

  /**
   * In case the array of items is not an array of strings,
   * this function is used on each item to return the string that will be shown on the filter
   */
  itemToString: _propTypes.default.func,

  /**
   * Properties forwarded to the input. Use with caution.
   */
  inputProps: _propTypes.default.object,

  /**
   * Properties forwarded to the button. Use with caution.
   */
  buttonProps: _propTypes.default.object,

  /**
   * Properties forwarded to the autocomplete component. Use with caution.
   */
  autocompleteProps: _propTypes.default.object
}));
(0, _defineProperty2.default)(Combobox, "defaultProps", {
  width: 240,
  openOnFocus: false
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21ib2JveC9zcmMvQ29tYm9ib3guanMiXSwibmFtZXMiOlsiQ29tYm9ib3giLCJwcm9wcyIsImNvbnRleHQiLCJjaGFuZ2VzIiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaXNPcGVuIiwic2V0U3RhdGUiLCJpc09wZW5lZEJ5QnV0dG9uIiwic3RhdGUiLCJpdGVtcyIsInNlbGVjdGVkSXRlbSIsImRlZmF1bHRTZWxlY3RlZEl0ZW0iLCJpdGVtVG9TdHJpbmciLCJ3aWR0aCIsImhlaWdodCIsIm9uQ2hhbmdlIiwicGxhY2Vob2xkZXIiLCJpbnB1dFByb3BzIiwiYnV0dG9uUHJvcHMiLCJvcGVuT25Gb2N1cyIsImF1dG9jb21wbGV0ZVByb3BzIiwiaGFuZGxlU3RhdGVDaGFuZ2UiLCJnZXRSZWYiLCJpc1Nob3duIiwib3Blbk1lbnUiLCJpbnB1dFZhbHVlIiwiZ2V0SW5wdXRQcm9wcyIsImdldEJ1dHRvblByb3BzIiwiY2xlYXJTZWxlY3Rpb24iLCJyZWYiLCJvbkZvY3VzIiwiZSIsInRhcmdldCIsInZhbHVlIiwidHJpbSIsIm9uQ2xpY2siLCJQdXJlQ29tcG9uZW50IiwiZGltZW5zaW9ucyIsInByb3BUeXBlcyIsInNwYWNpbmciLCJwb3NpdGlvbiIsImxheW91dCIsIlByb3BUeXBlcyIsImFycmF5IiwiaXNSZXF1aXJlZCIsImFueSIsImZ1bmMiLCJib29sIiwic3RyaW5nIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0lBRXFCQSxROzs7OztBQW1FbkIsb0JBQVlDLEtBQVosRUFBbUJDLE9BQW5CLEVBQTRCO0FBQUE7O0FBQUE7QUFDMUIsOEdBQU1ELEtBQU4sRUFBYUMsT0FBYjtBQUQwQiwwSUFPUixVQUFBQyxPQUFPLEVBQUk7QUFDN0IsVUFBSUMsTUFBTSxDQUFDQyxT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O0FBRXhCOzs7QUFHQTdCLEVBQUFBLFVBQVUsRUFBRXlCLG1CQUFVTyxNOztBQUV0Qjs7O0FBR0EvQixFQUFBQSxXQUFXLEVBQUV3QixtQkFBVU8sTTs7QUFFdkI7OztBQUdBN0IsRUFBQUEsaUJBQWlCLEVBQUVzQixtQkFBVU87OzhCQTNEWnBELFEsa0JBOERHO0FBQ3BCZ0IsRUFBQUEsS0FBSyxFQUFFLEdBRGE7QUFFcEJNLEVBQUFBLFdBQVcsRUFBRTtBQUZPLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IEJveCwgeyBkaW1lbnNpb25zLCBzcGFjaW5nLCBwb3NpdGlvbiwgbGF5b3V0IH0gZnJvbSAndWktYm94J1xuaW1wb3J0IHsgQXV0b2NvbXBsZXRlIH0gZnJvbSAnLi4vLi4vYXV0b2NvbXBsZXRlJ1xuaW1wb3J0IHsgVGV4dElucHV0IH0gZnJvbSAnLi4vLi4vdGV4dC1pbnB1dCdcbmltcG9ydCB7IEljb25CdXR0b24gfSBmcm9tICcuLi8uLi9idXR0b25zJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21ib2JveCBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIEltcGxlbWVudHMgc29tZSBBUElzIGZyb20gdWktYm94LlxuICAgICAqL1xuICAgIC4uLmRpbWVuc2lvbnMucHJvcFR5cGVzLFxuICAgIC4uLnNwYWNpbmcucHJvcFR5cGVzLFxuICAgIC4uLnBvc2l0aW9uLnByb3BUeXBlcyxcbiAgICAuLi5sYXlvdXQucHJvcFR5cGVzLFxuXG4gICAgLyoqXG4gICAgICogVGhlIG9wdGlvbnMgdG8gc2hvdyBpbiB0aGUgbWVudS5cbiAgICAgKi9cbiAgICBpdGVtczogUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2VsZWN0ZWQgaXRlbSB3aGVuIGNvbnRyb2xsZWQuXG4gICAgICovXG4gICAgc2VsZWN0ZWRJdGVtOiBQcm9wVHlwZXMuYW55LFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gY2FsbGVkIHdoZW4gdmFsdWUgY2hhbmdlcy5cbiAgICAgKi9cbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIG9wZW4gdGhlIGF1dG9jb21wbGV0ZSBvbiBmb2N1cy5cbiAgICAgKi9cbiAgICBvcGVuT25Gb2N1czogUHJvcFR5cGVzLmJvb2wsXG5cbiAgICAvKipcbiAgICAgKiBEZWZhdWx0IHNlbGVjdGVkIGl0ZW0gd2hlbiB1bmNvbnRyb2xsZWQuXG4gICAgICovXG4gICAgZGVmYXVsdFNlbGVjdGVkSXRlbTogUHJvcFR5cGVzLmFueSxcblxuICAgIC8qKlxuICAgICAqIFRoZSBwbGFjZWhvbGRlciB0ZXh0IHdoZW4gdGhlcmUgaXMgbm8gdmFsdWUgcHJlc2VudC5cbiAgICAgKi9cbiAgICBwbGFjZWhvbGRlcjogUHJvcFR5cGVzLnN0cmluZyxcblxuICAgIC8qKlxuICAgICAqIEluIGNhc2UgdGhlIGFycmF5IG9mIGl0ZW1zIGlzIG5vdCBhbiBhcnJheSBvZiBzdHJpbmdzLFxuICAgICAqIHRoaXMgZnVuY3Rpb24gaXMgdXNlZCBvbiBlYWNoIGl0ZW0gdG8gcmV0dXJuIHRoZSBzdHJpbmcgdGhhdCB3aWxsIGJlIHNob3duIG9uIHRoZSBmaWx0ZXJcbiAgICAgKi9cbiAgICBpdGVtVG9TdHJpbmc6IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgLyoqXG4gICAgICogUHJvcGVydGllcyBmb3J3YXJkZWQgdG8gdGhlIGlucHV0LiBVc2Ugd2l0aCBjYXV0aW9uLlxuICAgICAqL1xuICAgIGlucHV0UHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgICAvKipcbiAgICAgKiBQcm9wZXJ0aWVzIGZvcndhcmRlZCB0byB0aGUgYnV0dG9uLiBVc2Ugd2l0aCBjYXV0aW9uLlxuICAgICAqL1xuICAgIGJ1dHRvblByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuXG4gICAgLyoqXG4gICAgICogUHJvcGVydGllcyBmb3J3YXJkZWQgdG8gdGhlIGF1dG9jb21wbGV0ZSBjb21wb25lbnQuIFVzZSB3aXRoIGNhdXRpb24uXG4gICAgICovXG4gICAgYXV0b2NvbXBsZXRlUHJvcHM6IFByb3BUeXBlcy5vYmplY3RcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgd2lkdGg6IDI0MCxcbiAgICBvcGVuT25Gb2N1czogZmFsc2VcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XG4gICAgc3VwZXIocHJvcHMsIGNvbnRleHQpXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGlzT3BlbmVkQnlCdXR0b246IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgaGFuZGxlU3RhdGVDaGFuZ2UgPSBjaGFuZ2VzID0+IHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGNoYW5nZXMsICdpc09wZW4nKSkge1xuICAgICAgaWYgKCFjaGFuZ2VzLmlzT3Blbikge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaXNPcGVuZWRCeUJ1dHRvbjogZmFsc2UgfSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgaXRlbXMsXG4gICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICBkZWZhdWx0U2VsZWN0ZWRJdGVtLFxuICAgICAgaXRlbVRvU3RyaW5nLFxuICAgICAgd2lkdGgsXG4gICAgICBoZWlnaHQsXG4gICAgICBvbkNoYW5nZSxcbiAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgaW5wdXRQcm9wcyxcbiAgICAgIGJ1dHRvblByb3BzLFxuICAgICAgb3Blbk9uRm9jdXMsXG4gICAgICBhdXRvY29tcGxldGVQcm9wcyxcbiAgICAgIC4uLnByb3BzXG4gICAgfSA9IHRoaXMucHJvcHNcblxuICAgIHJldHVybiAoXG4gICAgICA8QXV0b2NvbXBsZXRlXG4gICAgICAgIGl0ZW1zPXtpdGVtc31cbiAgICAgICAgc2VsZWN0ZWRJdGVtPXtzZWxlY3RlZEl0ZW19XG4gICAgICAgIGRlZmF1bHRTZWxlY3RlZEl0ZW09e2RlZmF1bHRTZWxlY3RlZEl0ZW19XG4gICAgICAgIGl0ZW1Ub1N0cmluZz17aXRlbVRvU3RyaW5nfVxuICAgICAgICBvbkNoYW5nZT17b25DaGFuZ2V9XG4gICAgICAgIG9uU3RhdGVDaGFuZ2U9e3RoaXMuaGFuZGxlU3RhdGVDaGFuZ2V9XG4gICAgICAgIGlzRmlsdGVyRGlzYWJsZWQ9e3RoaXMuc3RhdGUuaXNPcGVuZWRCeUJ1dHRvbn1cbiAgICAgICAgey4uLmF1dG9jb21wbGV0ZVByb3BzfVxuICAgICAgPlxuICAgICAgICB7KHtcbiAgICAgICAgICBnZXRSZWYsXG4gICAgICAgICAgaXNTaG93bixcbiAgICAgICAgICBvcGVuTWVudSxcbiAgICAgICAgICBpbnB1dFZhbHVlLFxuICAgICAgICAgIGdldElucHV0UHJvcHMsXG4gICAgICAgICAgZ2V0QnV0dG9uUHJvcHMsXG4gICAgICAgICAgY2xlYXJTZWxlY3Rpb25cbiAgICAgICAgfSkgPT4gKFxuICAgICAgICAgIDxCb3hcbiAgICAgICAgICAgIGlubmVyUmVmPXtyZWYgPT4gZ2V0UmVmKHJlZil9XG4gICAgICAgICAgICBkaXNwbGF5PVwiaW5saW5lLWZsZXhcIlxuICAgICAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0SW5wdXRcbiAgICAgICAgICAgICAgd2lkdGg9ezB9XG4gICAgICAgICAgICAgIGZsZXg9ezF9XG4gICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICB2YWx1ZT17aW5wdXRWYWx1ZX1cbiAgICAgICAgICAgICAgYm9yZGVyVG9wUmlnaHRSYWRpdXM9ezB9XG4gICAgICAgICAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzPXswfVxuICAgICAgICAgICAgICB7Li4uZ2V0SW5wdXRQcm9wcyh7XG4gICAgICAgICAgICAgICAgLi4uaW5wdXRQcm9wcyxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcixcbiAgICAgICAgICAgICAgICBvbkZvY3VzOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAob3Blbk9uRm9jdXMpIG9wZW5NZW51KClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBlID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzT3BlbmVkQnlCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgaXNPcGVuZWRCeUJ1dHRvbjogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC52YWx1ZS50cmltKCkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgdGhlIHNlbGVjdGVkIGl0ZW0gZnJvbSBzdGlja2luZyBhcm91bmRcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJTZWxlY3Rpb24oKVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPEljb25CdXR0b25cbiAgICAgICAgICAgICAgaWNvbkFpbT1cImRvd25cIlxuICAgICAgICAgICAgICBjb2xvcj1cIm11dGVkXCJcbiAgICAgICAgICAgICAgaWNvbj1cImNhcmV0LWRvd25cIlxuICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICBtYXJnaW5MZWZ0PXstMX1cbiAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ9ezB9XG4gICAgICAgICAgICAgIHBhZGRpbmdSaWdodD17MH1cbiAgICAgICAgICAgICAgYm9yZGVyVG9wTGVmdFJhZGl1cz17MH1cbiAgICAgICAgICAgICAgYm9yZGVyQm90dG9tTGVmdFJhZGl1cz17MH1cbiAgICAgICAgICAgICAgey4uLmdldEJ1dHRvblByb3BzKHtcbiAgICAgICAgICAgICAgICAuLi5idXR0b25Qcm9wcyxcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoIWlzU2hvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlzT3BlbmVkQnlCdXR0b246IHRydWUgfSlcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L0JveD5cbiAgICAgICAgKX1cbiAgICAgIDwvQXV0b2NvbXBsZXRlPlxuICAgIClcbiAgfVxufVxuIl19